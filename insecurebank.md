<div align='center'>

# **Insecure Bank v2**

</div>

## **1.  "devadmin" account can login without password checking**

![](./imgs/InsecureBankv2/1.png)

![](./imgs/InsecureBankv2/2.png)

![](./imgs/InsecureBankv2/3.png)

## **2. Encrypted Credentials In Shared Preferences**

![](./imgs/InsecureBankv2/4.png)

## **3. Sensitive information in Logcat**

![](./imgs/InsecureBankv2/5.png)

## **4. Unencrypted Backup File**

![](./imgs/InsecureBankv2/6.png)

![](./imgs/InsecureBankv2/7.png)

![](./imgs/InsecureBankv2/8.png)

![](./imgs/InsecureBankv2/9.png)

![](./imgs/InsecureBankv2/10.png)

## **5. Weak Cryptography**

Hard coded key: "This is the super secret key 123"

![](./imgs/InsecureBankv2/11.png)

The encrypted credentials are stored in the shared preferences file.

![](./imgs/InsecureBankv2/10.png)

Use this [python script](./scripts/insecurebank/dec.py) to decrypt the credentials.

![](./imgs/InsecureBankv2/12.png)

## **6. Activity Hijacking**

![](./imgs/InsecureBankv2/13.png)

![](./imgs/InsecureBankv2/14.png)

## **7. Patching this app**

Decompile the app using `apktool`.

![](./imgs/InsecureBankv2/15.png)

**Become admin**

In `InsecureBankv2/res/values/strings.xml`, change the value of `is_admin` from 'no' to 'yes'.

![](./imgs/InsecureBankv2/16.png)

![](./imgs/InsecureBankv2/17.png)

Rebuild the app using `apktool`.

![](./imgs/InsecureBankv2/18.png)

Signing the app

![](./imgs/InsecureBankv2/19.png)

![](./imgs/InsecureBankv2/20.png)

![](./imgs/InsecureBankv2/21.png)

Install a patched app

![](./imgs/InsecureBankv2/22.png)

![](./imgs/InsecureBankv2/23.png)

**Bypassing root detection**

In `InsecureBankv2/smali/com/android/insecurebankv2/PostLogin.smali`, in method `showRootStatus()`. We can see that when if-ne v0, v1, it will jump to cond_2 which is the "Device not Rooted!!".

![](./imgs/InsecureBankv2/24.png)

![](./imgs/InsecureBankv2/25.png)

Change the code into `goto :cond_2` to bypass the root detection.

Rebuild, sign and install the app.

![](./imgs/InsecureBankv2/26.png)

## **7. Debug Enabled For App**

![](./imgs/TestCurl/11.png)

Can see the content of the package's directory (sqlite, shared preferences,...) as non-root user.

![](./imgs/InsecureBankv2/27.png)

![](./imgs/InsecureBankv2/28.png)

## **8. Flawed Broadcast Receivers**

![](./imgs/InsecureBankv2/29.png)

The `BroadcastReceiver`

![](./imgs/InsecureBankv2/31.png)

![](./imgs/InsecureBankv2/32.png)

We can see the old password from user

![](./imgs/InsecureBankv2/33.png)

## **9. Insecure Content Provider Access**

![](./imgs/InsecureBankv2/35.png)

![](./imgs/InsecureBankv2/34.png)

## **10. Parameter Manipulation**

Use Burpsuite to intercept the HTTP packet and examine it’s contents when the user submits their new password.

![](./imgs/InsecureBankv2/38.png)

If i change the value of `username` to `dinesh`, the password is changed for user `dinesh`.

![](./imgs/InsecureBankv2/39.png)

## **11. Username Enumeration**

Use Burp Intruder to enumerate the usernames.

![](./imgs/InsecureBankv2/40.png)

![](./imgs/InsecureBankv2/41.png)

Look at the response, we can see that the response's length is different when the username is valid or invalid.

![](./imgs/InsecureBankv2/42.png)

![](./imgs/InsecureBankv2/43.png)

![](./imgs/InsecureBankv2/44.png)

## **12. Insecure WebView Implementation**

The `ViewStatement` Activity is using a WebView to load a html file stored in external storage, the name of which begins with `Statements_`. I can also see that the developer has enabled JavaScript in the webview with the `setJavaScriptEnabled(true);` method. 

![](./imgs/InsecureBankv2/45.png)

Use logcat to identify the name of the file and it’s storage location due to the code `System.out.print` printing the files location to standard output

![](./imgs/InsecureBankv2/46.png)

The file is stored in `/storage/emulated/0/Statements_jack.html`

Replace this file with a new one which contains some JavaScript. This JavaScript will then be executed when the HTML page is loaded

```javascript
<script>alert("XSS!");</script>
```

Send this file to the device using adb.

![](./imgs/InsecureBankv2/47.png)

![](./imgs/InsecureBankv2/48.png)
